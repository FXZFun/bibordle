<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bibordle Search</title>
    <link rel="stylesheet" href="/res/styles/main.css" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
    <meta name="description" content="Bibordle | Guess The Five Letter Bible Word in Six Tries">
    <meta name="theme-color" content="#fafafa">
    <link rel="shortcut icon" type="image/png" href="../favicon.png">
    <link rel="manifest" href="/bibordle/manifest.json">
    <!-- Social -->
    <meta property="og:url" content="https://dubster.web.app/bibordle/" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Bibordle" />
    <meta property="og:description" content="Guess The Five Letter Bible Word in Six Tries" />
    <meta property="og:image" content="https://dubster.web.app/bibordle/theme.png" />
</head>

<body>
    <main>
        <div id="alert" class="alert">
            <p id="alertText">Hello</p>
        </div>
        <h1>Bibordle Search</h1>
        <div id="btnRow">
            <button id="daily" class="switchMode" onclick="location.href='/bibordle/'">Home</button>
        </div>
        <input type="text" placeholder="Search" id="wordSearch">
        <button onclick="getWord(document.getElementById('wordSearch').value);">Search</button>
        <p><span id="word">UNKNOWN</span> is in <span id="reference">UNKNOWN</span>:</p>
        <p id="verse">UNKNOWN</p>
        <button onclick="showChapter()">View Full Chapter</button>
        <button onclick="upChapter()">Go to next Chapter</button>
        <button onclick="downChapter()">Go to previous Chapter</button>
        <br>
        <select id="chapterSelect"></select>
        <select id="bookSelect"></select>
        <button
            onclick="jump(document.getElementById('bookSelect').value, parseInt(document.getElementById('chapterSelect').value))">Jump
            to Book</button>
        <br>
        <button
            onclick="share(document.getElementById('reference').innerText, document.getElementById('word').innerText)">Share
            Verse</button>
        </div>
        <div id="installContainer" class="hidden">
            <button id="buttonInstallDesktop"><i class="material-icons">install_desktop</i></button>
            <button id="buttonInstallMobile"><i class="material-icons">install_mobile</i></button>
        </div>
        <textarea id="share" style="opacity: 0;"></textarea>
    </main>
    <script src="/__/firebase/8.10.1/firebase-app.js"></script>
    <script src="/__/firebase/8.10.1/firebase-auth.js"></script>
    <script src="/__/firebase/8.10.1/firebase-database.js"></script>
    <script src="/res/scripts/words.js"></script>
    <script src="/res/scripts/kjv.js"></script>
    <!-- <script src="../shared.js"></script> -->
    <script src="/res/scripts/thing1.js"></script>
    <script>
        var kjv2;
        var verse;
        var book;
        var chapter;
        var newReference;
        function findVerse(wordToFind) {
            var matchString = wordToFind + "(?=[^\\w\\d])";
            var regFilter = new RegExp(matchString, "g");
            kjv2 = kjv.filter(v => v.text.toLowerCase().match(regFilter));
            return kjv2;
        }
        function findChapter(book, chapter) {
            kjv2 = kjv.filter(v => v.chapter == chapter && v["book_name"].toLowerCase() == book);
            return kjv2;
        }
        function getWord(word) {
            var verses = findVerse(word.toLowerCase());
            var verse = Math.floor(Math.random() * verses.length);
            if (verses[verse] != null) {
                document.getElementById("word").innerText = word.toUpperCase();
                document.getElementById("reference").innerText = verses[verse]["book_name"] + " " + verses[verse]["chapter"] + ":" + verses[verse]["verse"];
                var regFilter = new RegExp(word, "ig");
                document.getElementById("verse").innerHTML = verses[verse]['text'].replaceAll(regFilter, match => "<b>" + match + "</b>");
                document.title = document.getElementById("word").innerText + " | " + document.getElementById("reference").innerText + " | Bibordle Search"
                history.replaceState(null, "", "?load=true&word=" + document.getElementById("word").innerText + "&reference=" + document.getElementById("reference").innerText);
                chapter = verses[verse]["chapter"];
                book = verses[verse]["book_name"];
            } else {
                showAlert(word.toUpperCase() + " is not in the Bible", true);
            }
        }
        function getChapter(chapter, book) {
            console.log(book);
            var chapters = findChapter(book.toLowerCase(), chapter);
            document.getElementById("reference").innerText = book + " " + chapter;
            document.getElementById("verse").innerText = "";
            var regFilter = new RegExp(document.getElementById("word").innerText, "ig");
            chapters.forEach((c) => {
                var newText = c['text'].replaceAll(regFilter, match => "<b>" + match + "</b>");
                document.getElementById("verse").innerHTML += `<sup>${c["verse"]}</sup>${newText}`;
            });
            document.title = document.getElementById("word").innerText + " | " + document.getElementById("reference").innerText + " | Bibordle Search"
            history.replaceState(null, "", "?load=true&book=true&word=" + document.getElementById("word").innerText + "&reference=" + document.getElementById("reference").innerText);
            document.getElementById("chapterSelect").value = chapter;
            document.getElementById("bookSelect").value = book;
        }
        function loadWord(reference, word) {
            console.log(reference);
            i = 0;
            kjv.forEach(e => {
                newReference = e["book_name"] + " " + e["chapter"] + ":" + e["verse"];
                // console.log(newReference);
                if (newReference.toLowerCase() == reference.toLowerCase()) {
                    verse = i;
                }
                i = i + 1;
            });
            if (kjv[verse] != null) {
                document.getElementById("word").innerText = word.toUpperCase();
                document.getElementById("reference").innerText = kjv[verse]["book_name"] + " " + kjv[verse]["chapter"] + ":" + kjv[verse]["verse"];
                var regFilter = new RegExp(word, "ig");
                document.getElementById("verse").innerHTML = kjv[verse]['text'].replaceAll(regFilter, match => "<b>" + match + "</b>");
            }
            document.getElementById("wordSearch").value = word;
            document.title = document.getElementById("word").innerText + " | " + document.getElementById("reference").innerText + " | Bibordle Search"
            document.getElementById("chapterSelect").value = chapter;
            document.getElementById("bookSelect").value = book;
        }

        var params = new URLSearchParams(location.search);
        if (params.has("load")) {
            // getWord(params.get("word"));
            if (params.has("reference") && !params.has("book")) {
                chapter = parseInt(params.get("reference").split(" ")[1]);
                book = params.get("reference").split(" ")[0];
                loadWord(params.get("reference"), params.get("word"));
            } else if (params.has("book")) {
                chapter = parseInt(params.get("reference").split(" ")[1]);
                book = params.get("reference").split(" ")[0];
                document.getElementById("word").innerText = params.get("word").toUpperCase();
                showChapter();
            } else {
                getWord(params.get("word"));
                document.getElementById("wordSearch").value = params.get("word");
                params.append("reference", document.getElementById("reference").innerText);
                history.replaceState(null, "", "?load=true&word=" + params.get("word") + "&reference=" + document.getElementById("reference").innerText);
            }
        }

        function share(reference, word) {
            document.getElementById("share").value = "https://dubster.web.app/bibordle/search/?load=true&reference=" + reference + "&word=" + word;
            document.getElementById("share").select();
            document.execCommand("copy");
            alert('Copied!');
        }

        var chaptersAndBooks = { "Genesis": 50, "Exodus": 40, "Leviticus": 27, "Numbers": 36, "Deuteronomy": 34, "Joshua": 24, "Judges": 21, "Ruth": 4, "1 Samuel": 31, "2 Samuel": 24, "1 Kings": 22, "2 Kings": 25, "1 Chronicles": 29, "2 Chronicles": 36, "Ezra": 10, "Nehemiah": 13, "Esther": 10, "Job": 42, "Psalms": 150, "Proverbs": 31, "Ecclesiastes": 12, "Song of Solomon": 8, "Isaiah": 66, "Jeremiah": 52, "Lamentations": 5, "Ezekiel": 48, "Daniel": 12, "Hosea": 14, "Joel": 3, "Amos": 9, "Obadiah": 1, "Jonah": 3, "Micah": 7, "Nahum": 3, "Habakkuk": 3, "Zephaniah": 3, "Haggai": 2, "Zechariah": 14, "Malachi": 4, "Matthew": 28, "Mark": 16, "Luke": 24, "John": 21, "Acts": 28, "Romans": 16, "1 Corinthians": 16, "2 Corinthians": 13, "Galatians": 6, "Ephesians": 6, "Philippians": 4, "Colossians": 4, "1 Thessalonians": 5, "2 Thessalonians": 3, "1 Timothy": 6, "2 Timothy": 4, "Titus": 3, "Philemon": 1, "Hebrews": 12, "James": 5, "1 Peter": 5, "2 Peter": 3, "1 John": 5, "2 John": 1, "3 John": 0, "Jude": 0, "Revelation": 21 };
        var bookNames = ["Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy", "Joshua", "Judges", "Ruth", "1 Samuel", "2 Samuel", "1 Kings", "2 Kings", "1 Chronicles", "2 Chronicles", "Ezra", "Nehemiah", "Esther", "Job", "Psalms", "Proverbs", "Ecclesiastes", "Song of Solomon", "Isaiah", "Jeremiah", "Lamentations", "Ezekiel", "Daniel", "Hosea", "Joel", "Amos", "Obadiah", "Jonah", "Micah", "Nahum", "Habakkuk", "Zephaniah", "Haggai", "Zechariah", "Malachi", "Matthew", "Mark", "Luke", "John", "Acts", "Romans", "1 Corinthians", "2 Corinthians", "Galatians", "Ephesians", "Philippians", "Colossians", "1 Thessalonians", "2 Thessalonians", "1 Timothy", "2 Timothy", "Titus", "Philemon", "Hebrews", "James", "1 Peter", "2 Peter", "1 John", "2 John", "3 John", "Jude", "Revelation"];

        function showChapter() {
            getChapter(chapter, book);
        }

        function downChapter() {
            if (chapter != 1) {
                chapter += -1;
            } else {
                chapter = chaptersAndBooks[bookNames[bookNames.indexOf(book) - 1]];
                book = bookNames[bookNames.indexOf(book) - 1];
            }
            getChapter(chapter, book);
            document.getElementById("chapterSelect").value = chapter;
            document.getElementById("bookSelect").value = book;
        }

        function upChapter() {
            if (chapter != chaptersAndBooks[book]) {
                chapter += 1;
            } else {
                chapter = 1;
                book = bookNames[bookNames.indexOf(book) + 1];
            }
            getChapter(chapter, book);
            document.getElementById("chapterSelect").value = chapter;
            document.getElementById("bookSelect").value = book;
        }

        function jump(book2, chapter2) {
            book = book2;
            chapter = chapter2;
            getChapter(chapter, book);
            document.getElementById("chapterSelect").value = chapter;
            document.getElementById("bookSelect").value = book;
        }

        bookNames.forEach(b => {
            var c = document.createElement("option");
            c.value = b;
            c.innerText = b;
            document.getElementById("bookSelect").appendChild(c);
        });

        for (var i = 1; i <= chaptersAndBooks[book]; i++) {
            var c = document.createElement("option");
            c.value = i;
            c.innerText = i;
            document.getElementById("chapterSelect").appendChild(c);
        }

        document.getElementById("bookSelect").addEventListener("change", () => {
            book = document.getElementById("bookSelect").value;
            document.getElementById("chapterSelect").innerText = "";
            for (var i = 1; i <= chaptersAndBooks[book]; i++) {
                var c = document.createElement("option");
                c.value = i;
                c.innerText = i;
                document.getElementById("chapterSelect").appendChild(c);
            }
        });

        document.getElementById("chapterSelect").value = chapter;
        document.getElementById("bookSelect").value = book;
    </script>
</body>

</html>